{"version":3,"sources":["../app/utils/index.js","../app/config/index.js","../app/transformers/index.js","../app/services/cms/index.js","../app/services/cache/index.js","../app/store/Store.js","../app/store/index.js","../app/hooks/use-previous/index.js","../app/hooks/use-force-ssr-load/index.js","../app/hooks/index.js","../app/layout/Header/Header.jsx","../app/layout/Header/index.js","../app/pages/NotFound/NotFound.jsx","../app/pages/NotFound/index.js","../app/pages/Error/Error.jsx","../app/pages/Error/index.js","../app/components/RawHtml/RawHtml.jsx","../app/components/RawHtml/index.js","../app/pages/Start/Start.jsx","../app/pages/Start/index.js","../app/pages/Page/Page.jsx","../app/pages/Page/index.js","../app/pages/Post/Post.jsx","../app/pages/Post/index.js","../app/blocks/UnknownBlock/UnknownBlock.jsx","../app/blocks/UnknownBlock/index.js","../app/blocks/BlurbFull/BlurbFull.jsx","../app/blocks/BlurbFull/index.js","../app/blocks/BlurbBg/BlurbBg.jsx","../app/blocks/BlurbBg/index.js","../app/layout/Blocks/Blocks.jsx","../app/layout/Blocks/index.js","../app/pages/Recipe/Recipe.jsx","../app/pages/Recipe/index.js","../app/pages/RecipeList/RecipeList.jsx","../app/pages/RecipeList/index.js","../app/App.jsx","lib/ssr/index.js","index.js"],"names":["defined","obj","definedNotNull","isFn","fn","isArray","a","Array","isObj","isStr","debugState","debug","msg","console","warn","undefined","runningInBrowser","process","env","BABEL_ENV","runningOnServer","isDevEnv","NODE_ENV","range","args","start","end","length","from","v","k","reverse","x","xs","flatten","zip","arr","arrs","map","val","i","reduce","random","max","min","Math","pluckRandom","parseInt","generalConfig","cacheTtl","devDefaultConfig","wpHome","appBase","wpInjectedConfig","window","__FROJD_SETTINGS","config","routeTransformer","routes","deep","transformToRelativeUrl","item","ignoreUrlsWith","newItem","abort","filter","fileType","indexOf","replace","menuTransformer","menuData","menu","items","forEach","update","featuredImageTransformer","data","imageData","imageSizeTransformer","imageSizes","Object","keys","sizes","size","file","width","height","url","sourceUrl","slug","title","rendered","altText","caption","mimeType","mediaDetails","taxonomyTermTransformer","terms","newTerms","fixedTerms","term","tax","push","taxonomyCategoryTransformer","category","id","count","name","description","taxonomy","pageDataTransformer","featuredImage","taxonomies","keysToRemove","pageData","newData","key","excerpt","content","base","authConfig","nonce","withCredentials","headers","endpoints","primaryMenu","media","date","page","post","cpt","type","pages","posts","cpts","pageRevisions","pageRevision","revisionId","postRevisions","postRevision","cptRevisions","cptRevision","taxonomyCategories","getRoutes","resp","axios","get","transformers","getPrimaryMenu","getMedia","getDate","getContent","getPages","getRevisions","getRevision","getContentPreview","previewMediaId","revs","Promise","all","getTaxonomyCategories","categories","defaultTtl","currentTtl","entries","now","Date","getTime","setTtl","ttl","remove","hasKey","entry","timestamp","set","value","Store","constructor","initialState","states","error","loading","ready","serverSideBootstrapped","locationChanged","currentQuery","wpRestNonce","isLoggedIn","enforceActions","assign","cache","updateQueryParams","bootstrap","wpLoggedIn","loadRoutes","loadPrimaryMenu","state","setLocationChanged","bool","setServerSideBootstrapped","setQueryParams","params","hasQueryParams","hasPreviewQuery","queryString","parse","location","search","getError","stack","message","cms","loadContentAndInitialProps","getInitialProps","observable","object","pageInitialProps","loadingPageAndProps","loadContent","loadContentPreview","loadInitialProps","mediaId","props","action","defaultStore","storeContext","React","createContext","StoreProvider","store","children","__store","MockStoreProvider","dehydrate","base64","encode","rehydrate","storeJson","JSON","decode","useStore","useContext","Error","__FROJD_STATE","usePrevious","ref","current","useForceSsrLoad","didReload","setDidReload","r","Header","NotFound","defaultProps","code","RawHtml","html","__html","Start","initialProps","thumbnail","Page","willReload","Post","UnknownBlock","missingComponentId","BlurbFull","image","link","BlurbBg","backgroundImage","blockComponents","Blocks","block","acfFcLayout","Block","Recipe","recipeScore","recipeCategory","blocks","cat","RecipeList","recipes","recipeCategories","recipe","pageComponents","updateWpAdminBarEditButtonWithId","pageId","wrapEl","document","getElementById","linkEl","getElementsByTagName","editUrl","href","editRegex","match","updatedEditUrl","LocationSwitch","prevProps","pathname","App","ssr","renderRoute","route","PageComponent","component","contentPromise","postType","forwardRef","ssrRenderer","req","res","appRef","context","helmetContext","originalUrl","app","ReactDOMServer","renderToString","writeHead","Location","send","port","PORT","server","serveStatic","express","static","use","path","resolve","cwd","listen","log","info"],"mappings":"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","file":"index.js","sourceRoot":"../../server","sourcesContent":["// helpers\n\nconst defined = obj => typeof obj !== 'undefined';\nconst definedNotNull = obj => defined(obj) && obj != null;\nconst isFn = fn => typeof fn === 'function';\nconst isArray = a => Array.isArray(a);\nconst isObj = obj => typeof obj === 'object';\nconst isStr = obj => typeof obj === 'string';\n\nlet debugState = true;\nconst debug = (...msg) => debugState \n    ? console.warn(...msg)\n    : undefined; \n\nconst runningInBrowser = () => \n    process.env.BABEL_ENV === 'client';\n\nconst runningOnServer = () => \n    process.env.BABEL_ENV === 'server';\n\nconst isDevEnv = () => \n    process.env.NODE_ENV === 'development'; \n\n// ranges\n\nconst range = (...args) => {\n    let [start, end] = args.length == 2\n        ? args\n        : [0, args[0]];\n\n    return Array.from({length: (end - start)},\n        (v, k) => k + start\n    );\n}\n\n// array manipulation\n\nconst reverse = ([x, ...xs]) => typeof x !== 'undefined'\n    ? [...reverse(xs), x]\n    : [];\n\nconst flatten = ([x, ...xs]) => typeof x !== 'undefined'\n    ? Array.isArray(x)\n        ? [...flatten(x), ...flatten(xs)]\n        : [x, ...flatten(xs)]\n    : [];\n\nconst zip = (arr, ...arrs) =>\n    arr.map((val, i) =>\n        arrs.reduce((a, arr) =>\n            [...a, arr[i]], [val]\n        )\n    );\n\n// random no stuff\n\nconst random = (max = 1, min) => {\n    if(defined(min)) { \n        [min, max] = [max, min];\n    } else { \n        min = 0;\n    }\n\n    return Math.random() * (max - min) + min;\n}\n\nconst pluckRandom = (arr) =>\n    arr[parseInt(random(arr.length))];\n\nexport {\n    defined,\n    definedNotNull,\n    isFn,\n    isArray,\n    isObj,\n    isStr,\n    debug,\n    runningInBrowser,\n    runningOnServer, \n    isDevEnv,\n    range,\n    reverse,\n    zip,\n    flatten,\n    random,\n    pluckRandom\n};\n","import { \n    debug,\n    runningInBrowser,\n    runningOnServer,\n    isDevEnv\n} from '../utils';\n\nconst generalConfig = {\n    cacheTtl: 5 * 1000\n}\n\nconst devDefaultConfig = {\n    wpHome: 'http://repress.dev.test:8880',\n    appBase: runningOnServer() && isDevEnv()\n        ? 'http://web'\n        : 'http://repress.dev.test:8880',\n};\n\nconst wpInjectedConfig = runningInBrowser() && window.__FROJD_SETTINGS\n    ? window.__FROJD_SETTINGS\n    : {};\n\nconst config = {\n    ...generalConfig, \n    ...devDefaultConfig,\n    ...wpInjectedConfig\n};\n\ndebug('Loaded config: ', config);\n\nexport default config; ","import camelcaseKeys from 'camelcase-keys';\nimport traverse from 'traverse';\n\nimport { \n    isStr,\n    isArray, \n    flatten,\n} from '../utils';\n\nimport config from '../config';\n\nconst routeTransformer = (routes) => {\n    return camelcaseKeys(routes, { deep: true });\n};\n\n// transform any absolute url containing WP_HOME to a relative url\nconst transformToRelativeUrl = (item) => {\n    const ignoreUrlsWith = ['.png', '.jpg', '.jpeg', '.svg', '.gif', '.webp', '.ico'];\n\n    let newItem = item; \n\n    if (isStr(item)) {\n        const abort = ignoreUrlsWith\n            .filter(fileType => item.indexOf(fileType) > -1)\n            .length > 0;\n        \n        if (!abort && item.indexOf('http') > -1) {\n            newItem = item.replace(config.wpHome, '')\n        }\n    }\n\n    return newItem; \n}\n\nconst menuTransformer = (menuData) => {\n    let menu = camelcaseKeys(menuData, { deep: true });\n\n    traverse(menu.items)\n        .forEach(function(item) {\n            this.update(transformToRelativeUrl(item));\n        });\n\n    return menu;  \n};\n\nconst featuredImageTransformer = (data) => {\n    const imageData = camelcaseKeys(data, { deep: true });\n    if(!('mediaDetails' in imageData)) {\n        return null; \n    }\n\n    const imageSizeTransformer = (imageSizes) => \n        Object.keys(imageSizes)\n            .reduce((sizes, size, i) => {\n                sizes[size] = {\n                    file: imageSizes[size].file,\n                    width: imageSizes[size].width, \n                    height: imageSizes[size].height, \n                    url: imageSizes[size].sourceUrl\n                }; \n\n                return sizes; \n            }, {}); \n\n    return {\n        slug: imageData.slug, \n        title: imageData.title.rendered,\n        altText: imageData.altText, \n        caption: imageData.caption.rendered,\n        mimeType: imageData.mimeType,\n        sizes: imageSizeTransformer(imageData.mediaDetails.sizes)\n    }\n}\n\nconst taxonomyTermTransformer = (terms) => {\n    const newTerms = flatten(terms)\n        .reduce((fixedTerms, term) => {\n            const tax = term['taxonomy'];\n\n            if(!(tax in fixedTerms)) {\n                fixedTerms[tax] = []; \n            }\n\n            fixedTerms[tax].push(term);\n\n            return fixedTerms; \n        }, {});\n\n    return camelcaseKeys(newTerms);\n};\n\nconst taxonomyCategoryTransformer = (category) => {\n    return {\n        id: category.id, \n        count: category.count, \n        name: category.name, \n        slug: category.slug, \n        description: category.description,\n        taxonomy: category.taxonomy\n    }\n};\n\n// this function will remove all wp post props except those we need and convert all keys to camel case, \n// the final object will look something like this: \n// \n// {\n//     id,\n//     date,\n//     dateGmt,\n//     modified,\n//     modifiedGmt,\n//     slug,\n//     status, \n//     type, \n//     url, \n//     author, \n//     title, \n//     excerpt, \n//     content,\n//     featuredImage,\n//     ...\n//     <registered acf properties in camel case if available> \n// }\n\nconst pageDataTransformer = (data) => {    \n    const featuredImage = data['_embedded'] && data['_embedded']['wp:featuredmedia']\n        ? featuredImageTransformer(data['_embedded']['wp:featuredmedia'][0])\n        : null;\n\n    const taxonomies = data['_embedded'] && data['_embedded']['wp:term']\n        ? taxonomyTermTransformer(data['_embedded']['wp:term'])\n        : null; \n\n    const keysToRemove = ['guid', 'featured_media', 'template', '_links', 'link', '_embedded']; \n\n    let pageData = Object.keys(data)\n        .reduce((newData, key) => {\n            if (keysToRemove.indexOf(key) === -1 && data[key]) {\n                // don't include empty arrays \n                if (isArray(data[key]) && data[key].length === 0) {\n                    return newData; \n                }\n\n                newData[key] = data[key];\n                \n                traverse(newData[key]).forEach(function (item) {\n                    this.update(transformToRelativeUrl(item));\n                });\n            }\n\n            return newData; \n        }, {});\n\n    pageData = {\n        ...camelcaseKeys(pageData, { deep: true }), \n        ...taxonomies,\n        title: data.title.rendered, \n        excerpt: data.excerpt.rendered, \n        content: data.content.rendered,\n        featuredImage,\n    };\n\n    return pageData; \n};\n\nexport {\n    routeTransformer,\n    menuTransformer,\n    featuredImageTransformer,\n    taxonomyCategoryTransformer,\n    pageDataTransformer\n}","import * as transformers from '../../transformers';\n\nimport config from '../../config';\nimport { debug } from '../../utils';\n\nimport axios from 'axios';\n\nconst base = `${config.appBase}/wp-json`;\n\n// include auth cookies & wp nonce with req \nconst authConfig = (nonce) => ({\n    withCredentials: true, \n    headers: {\n        'X-WP-Nonce': nonce,\n        'Cache-Control': 'no-store'\n    }\n});\n\nconst endpoints = {\n    routes: () => \n        `${base}/router/v1/all/`,\n    primaryMenu: () =>\n        `${base}/menus/v1/menus/primary_navigation`,\n    media: (id) =>\n        `${base}/wp/v2/media/${id}`,\n    date: () =>\n        `${base}/date`,\n\n    page: (id) => \n        `${base}/wp/v2/pages/${id}?_embed`,\n    post: (id) =>\n        `${base}/wp/v2/posts/${id}?_embed`,\n    cpt: (id, type) => \n        `${base}/wp/v2/${type}/${id}?_embed`,\n\n    pages: () =>\n        `${base}/wp/v2/pages?_embed`,\n    posts: () =>\n        `${base}/wp/v2/posts?_embed`,\n    cpts: (type) =>\n        `${base}/wp/v2/${type}?_embed`,\n\n    pageRevisions: (id) => \n        `${base}/wp/v2/pages/${id}/revisions?filter[orderby]=date&order=desc`,\n    pageRevision: (id, revisionId) =>\n        `${base}/wp/v2/pages/${id}/revisions/${revisionId}?_embed`,\n\n    postRevisions: (id) =>\n        `${base}/wp/v2/posts/${id}/revisions?filter[orderby]=date&order=desc`,\n    postRevision: (id, revisionId) =>\n        `${base}/wp/v2/posts/${id}/revisions/${revisionId}?_embed`,\n\n    cptRevisions: (id, type) =>\n        `${base}/wp/v2/${type}/${id}/revisions?filter[orderby]=date&order=desc`,\n    cptRevision: (id, type, revisionId) =>\n        `${base}/wp/v2/${type}/${id}/revisions/${revisionId}?_embed`,\n\n    taxonomyCategories: (name) => \n        `${base}/wp/v2/${name}`\n};\n\ndebug('CMS Service: using base: ', base);\n\nconst getRoutes = async () => {\n    const resp = await axios.get(endpoints.routes());\n    return transformers\n        .routeTransformer(resp.data);\n}\n\nconst getPrimaryMenu = async () => {\n    const resp = await axios.get(endpoints.primaryMenu());\n    return transformers\n        .menuTransformer(resp.data);\n}\n\nconst getMedia = async (id, nonce) => {\n    debug('CMS getMedia() called!');\n    debug('CMS getMedia() nonce: ', nonce);\n    debug('CMS getMedia() media id: ', id);\n\n    const resp = await axios.get(endpoints.media(id), authConfig(nonce));\n    debug('CMS getMedia() transformed data: ', transformers.featuredImageTransformer(resp.data));\n\n    return transformers\n        .featuredImageTransformer(resp.data) \n}\n\nconst getDate = async () => {\n    return await axios.get(endpoints.date());\n}\n\nconst getContent = async (id, type) => {\n    let resp; \n\n    debug('CMS getContent(): fetching content for id: ', id);\n\n    switch(type) {\n        case 'page':\n            resp = await axios.get(endpoints.page(id));\n            break;\n        case 'post':\n            resp = await axios.get(endpoints.post(id));\n            break;\n        default: \n            resp = await axios.get(endpoints.cpt(id, type));\n            break;\n    }\n\n    return transformers\n        .pageDataTransformer(resp.data);\n}\n\nconst getPages = async (type) => {\n    let resp; \n\n    debug('CMS getPages(): fetching pages of type: ', type);\n\n    switch(type) {\n        case 'page':\n            resp = await axios.get(endpoints.pages());\n            break;\n        case 'post':\n            resp = await axios.get(endpoints.posts());\n            break;\n        default: \n            resp = await axios.get(endpoints.cpts(type));\n            break;\n    }\n\n    return resp.data.map(data => \n        transformers.pageDataTransformer(data)\n    ); \n}\n\n\nconst getRevisions = async (id, type, nonce) => {\n    let resp;\n    \n    switch (type) {\n        case 'page':\n            resp = await axios.get(endpoints.pageRevisions(id), authConfig(nonce));\n            break;\n        case 'post':\n            resp = await axios.get(endpoints.postRevisions(id), authConfig(nonce));\n            break;\n        default:\n            resp = await axios.get(endpoints.cptRevisions(id, type), authConfig(nonce));\n            break;\n    }\n\n    debug('CMS getRevisions(): fetched revision list for id: ', id, resp.data);\n\n    return resp.data; \n}\n\nconst getRevision = async (id, type, revisionId, nonce) => {\n\n    debug('CMS getRevision(): fetching revision content for id: ', id);\n\n    let resp;\n    switch (type) {\n        case 'page':\n            resp = await axios.get(endpoints.pageRevision(id, revisionId), authConfig(nonce));\n            break;\n        case 'post':\n            resp = await axios.get(endpoints.postRevision(id, revisionId), authConfig(nonce));\n            break;\n        default:\n            resp = await axios.get(endpoints.cptRevision(id, type, revisionId), authConfig(nonce));\n            break;\n    }\n\n    return transformers\n        .pageDataTransformer(resp.data);\n}\n\nconst getContentPreview = async (id, type, previewMediaId, nonce) => {\n    let pageData = {}, featuredImage = {}, revs = {};\n\n    debug('CMS getContentPreview() called!');\n    debug('CMS getContentPreview() nonce: ', nonce); \n    debug('CMS getContentPreview() preview media id: ', previewMediaId); \n\n    revs = await getRevisions(id, type, nonce);\n    debug('CMS: received post revision list: ', revs);\n\n    [featuredImage, pageData] = await Promise.all([\n        previewMediaId > -1\n            ? getMedia(previewMediaId, nonce)\n            : undefined, \n        getRevision(id, type, revs[0].id, nonce)\n    ]);\n\n    debug('CMS: getContentPreview() - received preview media data: ', featuredImage);\n\n    return {\n        ...pageData, \n        featuredImage\n    }\n}\n\nconst getTaxonomyCategories = async (name) => {\n    let resp = await axios.get(endpoints.taxonomyCategories(name));\n\n    const categories = resp.data.map(category => \n        transformers.taxonomyCategoryTransformer(category)\n    );\n\n    debug('CMS getTaxonomyCategories(): received categories: ', categories);\n\n    return categories;\n}\n\nexport {\n    getRoutes,\n    getPrimaryMenu,\n    getDate,\n    getMedia, \n    getContent, \n    getContentPreview,\n    getPages,\n    getTaxonomyCategories\n}","import { debug } from '../../utils';\n\nconst defaultTtl = 10 * 1000;\nlet currentTtl = defaultTtl; \n\nlet entries = {}; \n\nconst now = () => \n    new Date().getTime(); \n\nconst setTtl = (ttl) => {\n    debug(`Cache: setting cache ttl to ${ttl}ms`);\n    currentTtl = ttl; \n}\n\nconst remove = (key) =>\n    entries = Object.keys(entries)\n        .reduce((obj, k) => {\n            if (k !== key) {\n                obj[k] = entries[k]\n            }\n\n            return obj;\n        }, {}); \n\nconst hasKey = (key) => {\n    if(!(key in entries)) {\n        return false; \n    }\n\n    const entry = entries[key];\n\n    if (now() - entry.timestamp > currentTtl) {\n        debug(`Cache: entry with key \"${key}\" has expired`);\n        remove(key);\n\n        return false;\n    }\n\n    return true; \n}\n\nconst set = (key, value) => \n    entries = {\n        ...entries, \n        [key]: {\n            value, \n            timestamp: now()\n        }\n    };\n\nconst get = (key) => {\n    if (!(key in entries)) {\n        return null;\n    }\n\n    const entry = entries[key];\n\n    if (now() - entry.timestamp > currentTtl) {\n        debug(`Cache: entry with key \"${key}\" has expired`);\n        remove(key);\n        return null; \n    }\n\n    debug(`Cache: found entry with key \"${key}\", time left: `, now() - entry.timestamp);\n\n    return entry.value; \n};\n\nexport {\n    setTtl, \n    hasKey, \n    set, \n    remove,\n    get\n}","import {\n    observable,\n    action,\n    runInAction,\n    set,\n    configure as configureStore,\n} from 'mobx';\n\nimport queryString from 'query-string';\n\nimport { \n    defined,\n    isFn, \n    isStr,\n    isObj,\n    runningInBrowser,\n    debug\n} from '../utils';\n\nimport config from '../config';\n\nimport * as cms from '../services/cms';\nimport * as cache from '../services/cache';\n\n\nclass Store {\n    debug = true; \n\n    states = {\n        error: 'error',\n        loading: 'loading',\n        ready: 'ready'\n    };\n\n    constructor(initialState) {\n        configureStore({\n            enforceActions: 'always'\n        });\n\n        runInAction(() => {\n            Object.assign(this, initialState || {});\n        });\n\n        cache.setTtl(config.cacheTtl);\n        this.updateQueryParams(); \n    }\n\n    // main ui state\n    @observable state = this.states.loading;\n    @observable error = null; \n\n    // global state\n    serverSideBootstrapped = false; \n    locationChanged = false; \n    currentQuery = {};\n    wpRestNonce = {};\n    isLoggedIn = false; \n\n    @observable routes = [];\n    @observable primaryMenu = {}; \n\n    // current page state \n    @observable loadingPageAndProps = false; \n    @observable pageData = observable.object({});\n    @observable pageInitialProps = observable.object({}); \n\n    @action \n    async bootstrap() {\n        debug('Store: bootstrapping!');\n\n        if (runningInBrowser() && defined(window.__FROJD_SETTINGS)) {\n            this.wpRestNonce = window.__FROJD_SETTINGS.wpRestNonce;\n            this.isLoggedIn = window.__FROJD_SETTINGS.wpLoggedIn;\n\n            debug('Store: is logged in to WP: ', this.isLoggedIn);\n            debug('Store: using injected wp rest nonce: ', this.wpRestNonce);\n        }\n\n        await Promise.all([\n            this.loadRoutes(),\n            this.loadPrimaryMenu()\n        ]);\n\n        debug('Store: loaded routes & menus!');\n\n        runInAction(() => {\n            this.state = this.states.ready; \n        });\n    }\n\n    // getters / setters \n\n    setLocationChanged(bool) {\n        this.locationChanged = bool; \n    } \n\n    setServerSideBootstrapped(bool) {\n        this.serverSideBootstrapped = bool; \n    }\n\n    setQueryParams(params) {\n        debug('Store: setting query params to: ', params);\n        this.currentQuery = params;\n    }\n\n    hasQueryParams() {\n        return Object.keys(this.currentQuery)\n            .length > 0; \n    }\n\n    hasPreviewQuery() {\n        return this.hasQueryParams() \n            && 'preview' in this.currentQuery \n            && this.currentQuery['preview'] === 'true'; \n    }\n\n    updateQueryParams() {\n        if (runningInBrowser()) {\n            this.setQueryParams(\n                queryString.parse(window.location.search)\n            );\n        }\n    }\n\n    getError() {\n        if(isStr(this.error)) {\n            return this.error; \n        }\n\n        if(isObj(this.error) && 'stack' in this.error) {\n            return this.error.stack; \n        }\n\n        if (isObj(this.error) && 'message' in this.error) {\n            return this.error.message; \n        }\n\n        return null; \n    }\n\n    // actions\n\n    @action\n    async loadRoutes() {\n        try {\n            const routes = await cms.getRoutes();\n\n            runInAction(() => {\n                this.routes = routes;\n            });\n\n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n                this.error = error; \n            });\n        }\n    }\n\n    @action\n    async loadPrimaryMenu() {\n        try {\n            const menu = await cms.getPrimaryMenu();\n\n            runInAction(() => {\n                this.primaryMenu = menu;\n            });\n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n                this.error = error; \n            });\n        }\n    }\n\n    @action\n    async loadContentAndInitialProps(id, type, getInitialProps) {\n        this.updateQueryParams(); \n\n        debug('Store: loadContentAndInitialProps() called - loading content and initial props');\n        debug('Store: current query params: ', this.currentQuery);\n\n        // clear page data \n        // (in order to not render incorrect data on new page while new page data is loading)\n        this.pageData = observable.object({}); \n        debug('Store: cleared pageData'); \n\n        // clear initial props\n        // (in order to not render incorrect data on new page while new page props are loading)\n        this.pageInitialProps = observable.object({}); \n        debug('Store: cleared pageInitialProps'); \n\n        this.loadingPageAndProps = true; \n\n        const loadContent = () => this.hasPreviewQuery()\n            ? this.loadContentPreview(id, type)\n            : this.loadContent(id, type);\n\n        const loadInitialProps = () => isFn(getInitialProps)\n            ? this.loadInitialProps(getInitialProps)\n            : undefined;\n\n        await Promise.all([\n            loadContent(), \n            loadInitialProps()\n        ]); \n\n        runInAction(() => {\n            this.loadingPageAndProps = false\n        }); \n    }\n    \n    @action\n    async loadContent(id, type) {\n        debug('Store: loadContent() called - loading page data '); \n\n        if(cache.hasKey(id)) {\n            // this.pageData = observable.object({});\n            set(this.pageData, cache.get(id));\n            debug('Store: loadContent() - page data found in cache, returning cached data');\n            return;\n        }\n\n        try {\n            const content = await cms.getContent(id, type);\n\n            runInAction(() => {\n                // this.pageData = observable.object({}); \n                cache.set(id, content);\n                set(this.pageData, content);\n\n                debug('Store: set pageData: ', this.pageData);\n            });\n\n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n                this.error = error; \n            });\n        }\n    }\n\n    @action\n    async loadContentPreview(id, type) {\n        const mediaId = '_thumbnail_id' in this.currentQuery\n                ? this.currentQuery['_thumbnail_id']\n                : -1; \n            \n        debug('Store: loadContentPreview() called - loading PREVIEW page data ');\n        debug('Store: loadContentPreview() - will load featured media preview with media id: ', mediaId);\n\n        try {\n            const content = await cms.getContentPreview(id, type, mediaId, this.wpRestNonce);\n\n            runInAction(() => {\n                debug('Store: setting PREVIEW pageData: ', this.pageData);\n                set(this.pageData, content);\n            });\n\n        } catch (error) {\n            runInAction(() => {\n                debug('Store: loadContentPreview() FAILED, reason: ', error);\n\n                this.state = this.states.error;\n                this.error = error; \n            });\n        }\n    } \n\n    @action \n    async loadInitialProps(getInitialProps) {\n        debug('Store: loadInitialProps() called - loading props!');\n\n        try {\n            const props = await getInitialProps();\n            debug('Store: fetched initial props!');\n\n            runInAction(() => {\n                set(this.pageInitialProps, props);\n            }); \n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n                this.error = error; \n            });\n        }\n    }\n}\n\nexport default Store;\n","import React from 'react';\n\nimport { toJS } from 'mobx';\nimport jsonStringifySafe from 'json-stringify-safe';\nimport * as base64 from 'base64util';\n\nimport { \n    definedNotNull,\n    debug,\n    runningInBrowser\n} from '../utils';\n\nimport Store from './Store';\n\n\nlet defaultStore = new Store(); \nconst storeContext = React.createContext();\n\n\nconst StoreProvider = ({ store, children }) => {\n    const __store = definedNotNull(store)\n        ? store \n        : defaultStore; \n\n    return (\n        <storeContext.Provider value={__store}>\n            {children}\n        </storeContext.Provider>\n    );\n}\n\nconst MockStoreProvider = ({ store, children }) => {\n    return (\n        <storeContext.Provider value={store}>\n            {children}\n        </storeContext.Provider>\n    );\n}\n\n\nconst dehydrate = (store) => {\n    return base64.encode(jsonStringifySafe(toJS(store, true)));\n};\n\nconst rehydrate = (storeJson) => {\n    return JSON.parse(base64.decode(storeJson));\n}\n\n\nconst useStore = () => {\n    const store = React.useContext(storeContext);\n\n    if (!store) {\n        throw new Error('You\\'ve forgotten to use <StoreProvider/>, well shame on you...');\n    }\n\n    return store;\n}\n\n// hydrate ssr \nif (runningInBrowser() && definedNotNull(window.__FROJD_STATE)) {\n    let state = rehydrate(window.__FROJD_STATE);\n    defaultStore = new Store(state);\n\n    debug('Hydrated store with state: ', state);\n} else if (runningInBrowser()) { // ssr failed/not available, start bootstrap\n    debug('Could not find dehydrated state, bootstrapping store!');\n    defaultStore.bootstrap();\n}\n\nexport {\n    Store,\n    StoreProvider,\n    MockStoreProvider,\n    useStore,\n    dehydrate, \n    rehydrate\n}\n","import { \n    useRef,\n    useEffect\n } from 'react';\n\n// compare current & prev. props \nfunction usePrevious(value) {\n    const ref = useRef();\n\n    useEffect(() => {\n        ref.current = value;\n    }, [value]);\n\n    return ref.current;\n}\n\nexport default usePrevious; ","import { useState } from 'react';\nimport queryString from 'query-string';\n\nimport { useStore } from '../../store';\nimport { debug } from '../../utils';\n\nfunction useForceSsrLoad() {\n    const store = useStore(); \n    const [didReload, setDidReload] = useState(false);\n\n    if (process.env.BABEL_ENV === 'client' && store.serverSideBootstrapped) {\n        const { r } = queryString.parse(location.search);\n\n        if(!r && !didReload && store.locationChanged) {\n            debug('useForceSsrLoad() hook: page not yet reloaded - reloading!');\n            setDidReload(true);\n            window.location = `${window.location}?r=true`; \n\n            return true; \n        }\n\n        if (!r && didReload) {\n            return true; \n        }\n    }\n\n    debug('useForceSsrLoad() hook: NOT reloading!');\n    return false; \n}\n\n\nexport default useForceSsrLoad; \n","import usePrevious from './use-previous';\nimport useForceSsrLoad from './use-force-ssr-load';\n\nexport {\n    usePrevious,\n    useForceSsrLoad,\n}","\nimport React from 'react';\n\nimport { Link } from 'react-router-dom';\n\nimport { observer } from 'mobx-react-lite';\nimport { useStore } from '../../store';\n\nimport './Header.scss';\n\nconst Header = observer(() => {\n    let store = useStore();\n\n    return (\n        <header\n            className=\"Header\"\n        >\n            {store.primaryMenu && store.primaryMenu.items.map((item, i) => (\n                <Link \n                    className=\"Header__Link\"\n                    key={i} \n                    to={item.url}\n                >\n                    {item.title}\n                </Link>\n            ))}\n        </header>\n    );\n}); \n\nexport default Header; ","import Header from './Header';\nexport default Header; ","import React from 'react';\n// import PropTypes from 'prop-types';\n\nimport { Helmet } from 'react-helmet-async';\n\nconst NotFound = ({ message }) => {\n    return (\n        <>\n            <Helmet>\n                <title>404</title>\n            </Helmet>\n\n            <div>\n                <h1>404</h1>\n                <p>{message}</p> \n            </div>\n        </>\n    );\n};\n\nNotFound.defaultProps = {\n    message: 'The page could not be found'\n};\n\n\nexport default NotFound;","import NotFound from './NotFound';\n\nexport default NotFound; ","import React from 'react';\n// import PropTypes from 'prop-types';\n\nimport { Helmet } from 'react-helmet-async';\n\nconst Error = ({ code = '500', message }) => {\n    return (\n        <>\n            <Helmet>\n                <title>Error {code}</title>\n            </Helmet>\n\n            <div>\n                <h1>Error - {code}</h1>\n                <p>{message}</p> \n            </div>\n        </>\n    );\n};\n\nError.defaultProps = {\n    message: 'The page could not be found'\n};\n\n\nexport default Error;","import Error from './Error';\n\nexport default Error; ","import React from 'react';\n\nconst RawHtml = ({html, ...props}) => (\n    <div dangerouslySetInnerHTML={{__html: html}}></div>\n);\n\nexport default RawHtml; ","import RawHtml from './RawHtml';\n\nexport default RawHtml; \n","import React from 'react';\nimport { observer } from 'mobx-react-lite';\n\nimport { Helmet } from 'react-helmet-async';\nimport RawHtml from '../../components/RawHtml';\n\nimport {getDate as getServerSideDate} from '../../services/cms';\n\nconst Start = observer(({ pageData, initialProps }) => {\n    const { date } = initialProps;\n    const { title, content, featuredImage } = pageData; \n    \n    return (\n        <>\n            <Helmet>\n                <title>Start Page</title>\n            </Helmet>\n            <div>\n                <h1>Start page: {title}</h1>\n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n\n                <p>date initial prop: {date}</p>\n\n                <RawHtml html={content} />                \n            </div>\n        </>\n    );\n});\n\nStart.getInitialProps = async () => {\n    let resp = await getServerSideDate(); \n\n    return {\n        date: resp.data['date']\n    }\n};\n\nexport default Start;\n","import Start from './Start';\n\nexport default Start; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { Helmet } from 'react-helmet-async';\n\nimport RawHtml from '../../components/RawHtml';\n\nimport { useForceSsrLoad } from '../../hooks';\n\nconst Page = observer(({ pageData }) => {\n    const { title, content, featuredImage } = pageData; \n\n    const willReload = useForceSsrLoad();\n    if (willReload) {\n        return null;\n    }\n\n    return (\n        <>\n            <Helmet>\n                <title>Page</title>\n            </Helmet>\n            <div>\n                <h1>A page: {title}</h1>\n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n                \n                <RawHtml html={content} />\n            </div>\n\n        </>\n    );\n}); \n\nexport default Page;\n","import Page from './Page';\n\nexport default Page; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { Helmet } from 'react-helmet-async';\n\nimport RawHtml from '../../components/RawHtml';\n\nconst Post = observer(({ pageData }) => {\n    const { title, content, featuredImage } = pageData;\n\n   return  (\n        <>\n            <Helmet>\n                <title>Post</title>\n            </Helmet>\n            <div>\n                <h1>A poooost: {title}</h1>\n                \n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n\n                <RawHtml html={content} />\n            </div>\n        </>\n   );\n});\n\nexport default Post;\n","import Post from './Post';\n\nexport default Post; ","import React from 'react';\n\nimport './UnknownBlock.scss';\n\nconst UnknownBlock = ({ missingComponentId }) => {\n    return (\n        <div className=\"UnknownBlock\">\n            Could not find block with id: \"{missingComponentId}\"\n        </div>\n    );\n}; \n\nexport default UnknownBlock; ","import UnknownBlock from './UnknownBlock';\nexport default UnknownBlock; ","import React from 'react';\nimport { observer } from 'mobx-react-lite';\n\nimport { Link } from 'react-router-dom';\n\nimport './BlurbFull.scss';\n\nconst BlurbFull = observer(({ title, image, link }) => {\n    return (\n        <div className=\"BlurbFull\">\n            <h1>{title}</h1>\n            \n            {image && \n                <img src={image} />\n            }\n\n            <Link to={link.url}>\n                Click here\n            </Link>\n        </div>\n    );\n}); \n\nexport default BlurbFull; ","import BlurbFull from './BlurbFull';\nexport default BlurbFull; ","import React from 'react';\nimport { observer } from 'mobx-react-lite';\n\nimport { Link } from 'react-router-dom';\n\nimport './BlurbBg.scss';\n\nconst BlurbBg = observer(({ title, image, link }) => {\n    return (\n        <div \n            style={{backgroundImage: `url('${image}')`}}\n            className=\"BlurbBg\"\n        >\n            <Link to={link.url}>\n                Click here\n            </Link>\n        </div>\n    );\n}); \n\nexport default BlurbBg; ","import BlurbBg from './BlurbBg';\nexport default BlurbBg; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { debug } from '../../utils';\n\nimport UnknownBlock from '../../blocks/UnknownBlock';\nimport BlurbFull from '../../blocks/BlurbFull';\nimport BlurbBg from '../../blocks/BlurbBg';\n\nconst blockComponents = {\n    'blurb_full': BlurbFull,\n    'blurb_bg': BlurbBg\n};\n\n//\nconst Blocks = observer(({ items }) => {\n    debug('Blocks> passed block items: ', items);\n\n    if(!items || !items.length) {\n        return null; \n    }\n\n    return (\n        <div className=\"Blocks\">\n            {items.map((block, i) => {\n                const { acfFcLayout, ...props } = block; \n\n                if (!(acfFcLayout in blockComponents)) {\n                    return <UnknownBlock key={i} missingComponentId={acfFcLayout} />;\n                }\n                \n                const Block = blockComponents[acfFcLayout];\n\n                debug(`Blocks> found block component for ${acfFcLayout}: `, Block);\n                debug('Blocks> passing block props: ', props); \n\n                return <Block key={i} {...props} />; \n            })}\n        </div>\n    );\n}); \n\nexport default Blocks; ","import Blocks from './Blocks';\nexport default Blocks; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { Helmet } from 'react-helmet-async';\n\nimport Blocks from '../../layout/Blocks';\nimport RawHtml from '../../components/RawHtml';\n\nimport * as cms from '../../services/cms';\n\nconst Recipe = observer(({ loading, id, url, pageData, initialProps }) => {\n    const { title, content, featuredImage, recipeScore, recipeCategory, blocks } = pageData; \n    const { date } = initialProps; \n\n    return (\n        <>\n            <Helmet>\n                <title>{`Recipe Page - ${title || ''}`}</title>\n            </Helmet>\n            <div>\n                {loading &&\n                    <h1>LOADING PAGE & PROPS!</h1>\n                }\n\n                <h1>Recept: {title}</h1>\n                <h3>date initial prop: {date}</h3>\n\n                {recipeCategory && \n                    <>\n                        <h4>Recipe categories: </h4>\n                        {recipeCategory.map((cat) =>\n                            <p key={cat.slug}>{cat.name}</p>\n                        )}\n                    </>\n                }\n\n                <h4>Score: {recipeScore ? recipeScore : 'missing'}</h4>\n\n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n                \n                <p>id: {id}</p>\n                <p>url: {url}</p>\n\n                <RawHtml html={content} />\n\n                {blocks && \n                    <Blocks items={blocks} />                \n                }\n            </div>\n        </>\n    );\n});\n\nRecipe.getInitialProps = async () => {\n    const resp = await cms.getDate(); \n\n    return {\n        date: resp.data['date']\n    }\n};\n\nexport default Recipe;","import Recipe from './Recipe';\n\nexport default Recipe; ","import React from 'react';\n\nimport { Link } from 'react-router-dom';\n\nimport { observer } from 'mobx-react-lite';\nimport { Helmet } from 'react-helmet-async';\n\nimport RawHtml from '../../components/RawHtml';\n\nimport * as cms from '../../services/cms';\n\n// import { debug } from '../../utils';\n\nconst RecipeList = observer(({ loading, pageData, initialProps }) => {\n    const { title, content, featuredImage } = pageData; \n    const { recipes, recipeCategories } = initialProps; \n\n    return (\n        <>\n            <Helmet>\n                <title>{`RecipeList Page - ${title || ''}`}</title>\n            </Helmet>\n            <div>\n                {loading &&\n                    <h1>LOADING PAGE & PROPS!</h1>\n                }\n\n                <h1>Recipe list page: {title}</h1>\n\n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n                \n                <RawHtml html={content} />\n\n                <h2>Available recipe categories</h2>\n                {recipeCategories && recipeCategories.length &&\n                    <ul>\n                        {recipeCategories.map(category =>\n                            <li key={category.id}>\n                                {category.name}\n                            </li>\n                        )}\n                    </ul>\n                }\n\n                <h2>All recipes</h2>\n                {recipes && recipes.length && \n                    <ul>\n                        {recipes.map(recipe =>\n                            <li key={recipe.slug}>\n                                <Link to={recipe.url}>\n                                    {recipe.title}\n                                </Link>\n                            </li>\n                        )}\n                    </ul>\n                }\n\n            </div>\n        </>\n    );\n});\n\nRecipeList.getInitialProps = async () => {\n    const [recipes, recipeCategories] = await Promise.all([\n        cms.getPages('recipe'),\n        cms.getTaxonomyCategories('recipe_category')\n    ]);\n\n    return {\n        recipes,\n        recipeCategories\n    }\n};\n\nexport default RecipeList;","import RecipeList from './RecipeList';\n\nexport default RecipeList; ","import React from 'react';\n\nimport { \n    Switch, \n    Route, \n    withRouter,\n} from 'react-router-dom';\n\nimport { observer } from 'mobx-react-lite';\nimport { useStore } from './store';\n\nimport { \n    usePrevious, \n} from './hooks';\n\nimport Header from './layout/Header';\nimport NotFound from './pages/NotFound';\nimport Error from './pages/Error';\n\nimport Start from './pages/Start';\nimport Page from './pages/Page';\nimport Post from './pages/Post';\nimport Recipe from './pages/Recipe';\nimport RecipeList from './pages/RecipeList';\n\n\nimport { defined, debug } from './utils';\n\nconst pageComponents = {\n    'Start': Start, \n    'Page': Page, \n    'Post': Post, \n    'Recipe': Recipe,\n    'Recipe list': RecipeList\n};\n\nconst updateWpAdminBarEditButtonWithId = (pageId) => {\n    const wrapEl = document.getElementById('wp-admin-bar-edit');\n    if(!wrapEl) {\n        return; \n    }\n\n    const linkEl = wrapEl.getElementsByTagName('a')[0];\n    const editUrl = linkEl.href;\n\n    const editRegex = /(.*)(post=)(\\d+)(.*)/;\n    if (editUrl.match(editRegex)) {\n        const updatedEditUrl = editUrl.replace(editRegex, `$1$2${pageId}$4`);\n        linkEl.href = updatedEditUrl;\n        debug('App> updateWpAdminBarEditButtonWithId() - updating edit button id to: ', pageId);\n    }\n}\n\nconst LocationSwitch = withRouter((props) => {\n    const store = useStore();\n\n    const { children } = props; \n    const prevProps = usePrevious(props);\n\n    // check whether user has navigated or whether this is the initial load without a hydrated store \n    // if yes, set location to changed in order to trigger page data & initial props load \n    // for route (see renderRoute()) \n\n    if ((prevProps && prevProps.location.pathname !== props.location.pathname) \n        || (!prevProps && !store.serverSideBootstrapped)) \n    {\n        debug('LocationSwitch> setting location changed state to: ', true);\n\n        store.setLocationChanged(true);\n    } else {\n        debug('LocationSwitch> setting location changed state to: ', false);\n        debug('LocationSwitch> was ssr bootstrapped: ', store.serverSideBootstrapped);\n\n        store.setLocationChanged(false);\n    }\n\n    return (\n        <Switch>\n            {children}\n        </Switch>\n    ); \n}); \n\nconst App = observer(({ ssr = false }, ref) => {\n    let store = useStore();\n\n    // trigger a rerender when these props are changed\n    store.loadingPageAndProps;\n    store.pageData;\n    store.pageInitialProps;\n\n    if(store.state === store.states.loading) {\n        return (\n            <div>Loading...</div>\n        );\n    }\n\n    if (store.state === store.states.error) {\n        return (\n            <div>\n                <h3>An error occured:</h3> \n                <code>{store.getError()}</code>\n            </div>\n        );\n    }\n\n    const renderRoute = (props, route) => {\n        debug('App> renderRoute() called');\n        debug('App> has location changed?', store.locationChanged);\n\n        let PageComponent = pageComponents[route.component];\n\n        if(!defined(PageComponent)) {\n            const message = `Could not render page - no React component mapped to name \"${route.component}\" found!`; \n            console.error(`App> Could not render page - no React component mapped to name \"${route.component}\" found!`);\n\n            PageComponent = () => (\n                <Error \n                    code=\"501\"\n                    message={message} \n                />\n            );\n        }\n\n        // expose promises in ref (enables us to wait for \n        // data load when doing ssr, see server/lib/ssr/index.js).\n\n        if(ref && defined(ref.current) && ref.current === null) { // ssr\n            debug('App> renderRoute is triggering SSR data & props load procedure - will not render this run'); \n\n            ref.current = {\n                contentPromise: store.loadContentAndInitialProps(\n                    route.id, \n                    route.postType, \n                    PageComponent.getInitialProps\n                )\n            };\n\n            // don't render anything here, just trigger the promise \n            // the ssr renderer will trigger a new render when the promise is resolved\n\n            return null; \n        } else if(!ssr && store.locationChanged) { // client \n            debug('App> renderRoute is triggering CLIENT data & props load procedure'); \n\n            store.loadContentAndInitialProps(\n                route.id, \n                route.postType, \n                PageComponent.getInitialProps\n            );\n\n            updateWpAdminBarEditButtonWithId(route.id);\n        }\n\n        debug('App> current loaded pageData: ', store.pageData);\n        \n        return (\n            <PageComponent\n                id={route.id}\n                type={route.postType}\n                url={route.url}\n\n                loading={store.loadingPageAndProps}\n                pageData={store.pageData}\n                initialProps={store.pageInitialProps}\n\n                {...props}\n            />\n        );\n    };\n\n    return (\n        <>\n            <Header />\n            <LocationSwitch ssr={ssr}>\n                {store.routes.map(route => (\n                    <Route\n                        exact\n                        key={route.url}\n                        path={route.url}\n                        render={(props) => renderRoute(props, route)}\n                    />\n                ))}\n                <Route component={NotFound} />\n            </LocationSwitch>\n        </>\n    );\n\n}, { forwardRef: true });\n\nexport default App;\n","import React, {\n    createRef,\n} from 'react';\n\nimport ReactDOMServer from 'react-dom/server';\n\nimport { useStaticRendering } from 'mobx-react-lite';\n\nimport { HelmetProvider } from 'react-helmet-async';\nimport { StaticRouter } from 'react-router-dom';\n\nimport { \n    StoreProvider, \n    Store, \n    dehydrate \n} from '../../../app/store';\n\nimport App from '../../../app/App';\n\nimport { debug }  from '../../../app/utils';\n\nuseStaticRendering(true);\n\nconst ssrRenderer = async (req, res) => {\n    let appRef = createRef(null);\n\n    const context = {};\n    const helmetContext = {};\n    \n    const store = new Store(); \n\n    debug('SSR renderer: calling store bootstrap!');\n    await store.bootstrap();\n\n    const component = (\n        <StoreProvider store={store}>\n            <HelmetProvider context={helmetContext}>\n                <StaticRouter\n                    location={req.originalUrl}\n                    context={context}\n                >\n                    <App \n                        ssr={true}\n                        ref={appRef}    \n                    />\n                </StaticRouter>\n            </HelmetProvider>\n        </StoreProvider>\n    );\n\n\n    // render once to trigger router & content data load, then await \n    // data load promise exposed by the <App> ref & re-render with loaded data.\n\n    let app = '';\n    ReactDOMServer.renderToString(component);\n    if (appRef.current && appRef.current.contentPromise) {\n        debug('SSR Renderer: waiting for content promise!');\n        await appRef.current.contentPromise;\n\n        debug('SSR Renderer: content promise resolved!');\n        app = ReactDOMServer.renderToString(component);\n    }\n\n    store.setServerSideBootstrapped(true);\n\n    const html = `\n        <div id=\"root\">${app}</div>\n        <script>\n            window.__FROJD_STATE = '${dehydrate(store)}';\n        </script>\n    `;\n\n    if (context.url) {\n        debug('SSR renderer: 301 redirect!');\n        res.writeHead(301, { Location: context.url });\n        res.end();\n    } else {\n        debug('SSR renderer: responding with rendered html!');\n        res.send(html);\n    }\n};\n\nexport default ssrRenderer;","import express from 'express';\nimport path from 'path';\nimport log from 'llog';\n\nimport ssr from './lib/ssr';\n\nconst port = process.env.PORT || 1234;\n\nconst server = express();\nconst serveStatic = express.static;\n\nserver.use(\n    '/dist/client',\n    serveStatic(path.resolve(process.cwd(), '__dist', 'client'))\n);\n\nserver.get('/*', ssr);\n\nserver.listen(port, () => {\n    log.info(`Listening on port ${port} - have fun!`)\n});"]}