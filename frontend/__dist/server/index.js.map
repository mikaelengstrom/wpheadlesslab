{"version":3,"sources":["../app/utils/index.js","../app/config/index.js","../app/transformers/index.js","../app/services/cms/index.js","../app/services/cache/index.js","../app/store/Store.js","../app/store/index.js","../app/hooks/use-previous/index.js","../app/hooks/use-force-ssr-load/index.js","../app/hooks/index.js","../app/layout/Header/Header.jsx","../app/layout/Header/index.js","../app/pages/NotFound/NotFound.jsx","../app/pages/NotFound/index.js","../app/components/RawHtml/RawHtml.jsx","../app/components/RawHtml/index.js","../app/pages/Start/Start.jsx","../app/pages/Start/index.js","../app/pages/Page/Page.jsx","../app/pages/Page/index.js","../app/pages/Post/Post.jsx","../app/pages/Post/index.js","../app/blocks/UnknownBlock/UnknownBlock.jsx","../app/blocks/UnknownBlock/index.js","../app/blocks/BlurbFull/BlurbFull.jsx","../app/blocks/BlurbFull/index.js","../app/layout/Blocks/Blocks.jsx","../app/layout/Blocks/index.js","../app/pages/Recipe/Recipe.jsx","../app/pages/Recipe/index.js","../app/App.jsx","lib/ssr/index.js","index.js"],"names":["defined","obj","definedNotNull","isFn","fn","isArray","a","Array","isObj","isStr","debugState","debug","msg","console","warn","undefined","range","args","start","end","length","from","v","k","reverse","x","xs","flatten","zip","arr","arrs","map","val","i","reduce","random","max","min","Math","pluckRandom","parseInt","generalConfig","cacheTtl","devDefaultConfig","wpHome","appBase","process","env","BABEL_ENV","NODE_ENV","wpInjectedConfig","window","__FROJD_SETTINGS","config","routeTransformer","routes","deep","transformToRelativeUrl","item","ignoreUrlsWith","newItem","abort","filter","fileType","indexOf","replace","menuTransformer","menuData","menu","items","forEach","update","featuredImageTransformer","data","imageData","imageSizeTransformer","imageSizes","Object","keys","sizes","size","file","width","height","url","sourceUrl","slug","title","rendered","altText","caption","mimeType","mediaDetails","pageDataTransformer","featuredImage","keysToRemove","pageData","newData","key","excerpt","content","base","authConfig","nonce","withCredentials","headers","endpoints","primaryMenu","media","id","date","page","post","cpt","type","pageRevisions","pageRevision","revisionId","postRevisions","postRevision","cptRevisions","cptRevision","getRoutes","resp","axios","get","transformers","getPrimaryMenu","getMedia","getDate","getContent","getRevisions","getRevision","getContentPreview","previewMediaId","revs","Promise","all","defaultTtl","currentTtl","entries","now","Date","getTime","setTtl","ttl","remove","hasKey","entry","timestamp","set","value","Store","constructor","initialState","states","error","loading","ready","serverSideBootstrapped","locationChanged","currentQuery","wpRestNonce","enforceActions","cache","assign","setQueryParams","queryString","parse","location","search","bootstrap","loadRoutes","loadPrimaryMenu","state","setLocationChanged","bool","setServerSideBootstrapped","params","hasQueryParams","hasPreviewQuery","loadContentAndInitialProps","getInitialProps","observable","object","pageInitialProps","loadContent","loadContentPreview","loadInitialProps","cms","mediaId","props","action","storeContext","React","createContext","defaultStore","dehydrate","store","base64","encode","rehydrate","storeJson","JSON","decode","__FROJD_STATE","StoreProvider","children","__store","MockStoreProvider","useStore","useContext","Error","usePrevious","ref","current","useForceSsrLoad","didReload","setDidReload","r","Header","NotFound","RawHtml","html","__html","Start","initialProps","willReload","Page","thumbnail","Post","UnknownBlock","missingComponentId","BlurbFull","image","link","blockComponents","Blocks","block","acfFcLayout","Block","Recipe","recipeScore","blocks","pageComponents","LocationSwitch","prevProps","pathname","App","ssr","renderRoute","route","PageComponent","component","contentPromise","postType","forwardRef","ssrRenderer","req","res","appRef","context","helmetContext","originalUrl","app","ReactDOMServer","renderToString","writeHead","Location","send","port","PORT","server","serveStatic","express","static","use","path","resolve","cwd","listen","log","info"],"mappings":"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","file":"index.js","sourceRoot":"../../server","sourcesContent":["// helpers\n\nconst defined = obj => typeof obj !== 'undefined';\nconst definedNotNull = obj => defined(obj) && obj != null;\nconst isFn = fn => typeof fn === 'function';\nconst isArray = a => Array.isArray(a);\nconst isObj = obj => typeof obj === 'object';\nconst isStr = obj => typeof obj === 'string';\n\nlet debugState = true;\nconst debug = (...msg) => debugState \n    ? console.warn(...msg)\n    : undefined; \n\n// ranges\n\nconst range = (...args) => {\n    let [start, end] = args.length == 2\n        ? args\n        : [0, args[0]];\n\n    return Array.from({length: (end - start)},\n        (v, k) => k + start\n    );\n}\n\n// array manipulation\n\nconst reverse = ([x, ...xs]) => typeof x !== 'undefined'\n    ? [...reverse(xs), x]\n    : [];\n\nconst flatten = ([x, ...xs]) => typeof x !== 'undefined'\n    ? Array.isArray(x)\n        ? [...flatten(x), ...flatten(xs)]\n        : [x, ...flatten(xs)]\n    : [];\n\nconst zip = (arr, ...arrs) =>\n    arr.map((val, i) =>\n        arrs.reduce((a, arr) =>\n            [...a, arr[i]], [val]\n        )\n    );\n\n// random no stuff\n\nconst random = (max = 1, min) => {\n    if(defined(min)) { \n        [min, max] = [max, min];\n    } else { \n        min = 0;\n    }\n\n    return Math.random() * (max - min) + min;\n}\n\nconst pluckRandom = (arr) =>\n    arr[parseInt(random(arr.length))];\n\nexport {\n    defined,\n    definedNotNull,\n    isFn,\n    isArray,\n    isObj,\n    isStr,\n    debug, \n    range,\n    reverse,\n    zip,\n    flatten,\n    random,\n    pluckRandom\n};\n","import { debug } from '../utils';\n\nconst generalConfig = {\n    cacheTtl: 30 * 1000\n}\n\nconst devDefaultConfig = {\n    wpHome: 'http://repress.dev.test:8880',\n    appBase: process.env.BABEL_ENV === 'server'\n        && process.env.NODE_ENV === 'development'\n        ? 'http://web'\n        : 'http://repress.dev.test:8880',\n};\n\nconst wpInjectedConfig = process.env.BABEL_ENV === 'client' \n    && window && window.__FROJD_SETTINGS\n        ? window.__FROJD_SETTINGS\n        : {};\n\nconst config = {\n    ...generalConfig, \n    ...devDefaultConfig,\n    ...wpInjectedConfig\n};\n\ndebug('Loaded config: ', config);\n\nexport default config; ","import camelcaseKeys from 'camelcase-keys';\nimport traverse from 'traverse';\n\nimport { \n    isStr,\n} from '../utils';\n\nimport config from '../config';\n\nconst routeTransformer = (routes) => {\n    return camelcaseKeys(routes, { deep: true });\n};\n\nconst transformToRelativeUrl = (item) => {\n    const ignoreUrlsWith = ['.png', '.jpg', '.jpeg', '.svg', '.gif', '.webp', '.ico'];\n\n    let newItem = item; \n\n    if (isStr(item)) {\n        const abort = ignoreUrlsWith\n            .filter(fileType => item.indexOf(fileType) > -1).length > 0;\n        \n        if (!abort && item.indexOf('http') > -1) {\n            newItem = item.replace(config.wpHome, '')\n        }\n    }\n\n    return newItem; \n}\n\nconst menuTransformer = (menuData) => {\n    let menu = camelcaseKeys(menuData, { deep: true });\n\n    traverse(menu.items).forEach(function(item) {\n        this.update(transformToRelativeUrl(item));\n    });\n\n    return menu;  \n};\n\nconst featuredImageTransformer = (data) => {\n    const imageData = camelcaseKeys(data, { deep: true });\n\n    const imageSizeTransformer = (imageSizes) => \n        Object.keys(imageSizes)\n            .reduce((sizes, size, i) => {\n                sizes[size] = {\n                    file: imageSizes[size].file,\n                    width: imageSizes[size].width, \n                    height: imageSizes[size].height, \n                    url: imageSizes[size].sourceUrl\n                }; \n\n                return sizes; \n            }, {}); \n\n    return {\n        slug: imageData.slug, \n        title: imageData.title.rendered,\n        altText: imageData.altText, \n        caption: imageData.caption.rendered,\n        mimeType: imageData.mimeType,\n        sizes: imageSizeTransformer(imageData.mediaDetails.sizes)\n    }\n}\n\n// this function will remove all wp post props except those we need and convert all keys to camel case, \n// the final object will look something like this: \n// \n// {\n//     id,\n//     date,\n//     dateGmt,\n//     modified,\n//     modifiedGmt,\n//     slug,\n//     status, \n//     type, \n//     url, \n//     author, \n//     title, \n//     excerpt, \n//     content,\n//     featuredImage,\n//     ...\n//     <acf properties in camel case if available> \n// }\n\nconst pageDataTransformer = (data) => {    \n    const featuredImage = data['_embedded'] && data['_embedded']['wp:featuredmedia']\n        ? featuredImageTransformer(data['_embedded']['wp:featuredmedia'][0])\n        : null;\n    \n    const keysToRemove = ['guid', 'featured_media', 'template', '_links', 'link', '_embedded']; \n\n    let pageData = Object.keys(data)\n        .reduce((newData, key) => {\n            if(keysToRemove.indexOf(key) === -1) {\n                newData[key] = data[key];\n                \n                traverse(newData[key]).forEach(function (item) {\n                    this.update(transformToRelativeUrl(item));\n                });\n            }\n\n            return newData; \n        }, {});\n\n    pageData = {\n        ...camelcaseKeys(pageData, { deep: true }), \n        title: data.title.rendered, \n        excerpt: data.excerpt.rendered, \n        content: data.content.rendered,\n        featuredImage \n    };\n\n    return pageData; \n};\n\nexport {\n    routeTransformer,\n    menuTransformer,\n    featuredImageTransformer,\n    pageDataTransformer\n}","import * as transformers from '../../transformers';\n\nimport config from '../../config';\nimport { debug } from '../../utils';\n\nimport axios from 'axios';\n\nconst base = `${config.appBase}/wp-json`;\n\n// include auth cookies & wp nonce with req \nconst authConfig = (nonce) => ({\n    withCredentials: true, \n    headers: {\n        'X-WP-Nonce': nonce,\n        'Cache-Control': 'no-store'\n    }\n});\n\nconst endpoints = {\n    routes: () => \n        `${base}/router/v1/all/`,\n    primaryMenu: () =>\n        `${base}/menus/v1/menus/primary_navigation`,\n    media: (id) =>\n        `${base}/wp/v2/media/${id}`,\n    date: () =>\n        `${base}/date`,\n\n    page: (id) => \n        `${base}/wp/v2/pages/${id}`,\n    post: (id) =>\n        `${base}/wp/v2/posts/${id}`,\n    cpt: (id, type) => \n        `${base}/wp/v2/${type}/${id}?_embed`,\n\n    pageRevisions: (id) => \n        `${base}/wp/v2/pages/${id}/revisions?filter[orderby]=date&order=desc`,\n    pageRevision: (id, revisionId) =>\n        `${base}/wp/v2/pages/${id}/revisions/${revisionId}?_embed`,\n\n    postRevisions: (id) =>\n        `${base}/wp/v2/posts/${id}/revisions?filter[orderby]=date&order=desc`,\n    postRevision: (id, revisionId) =>\n        `${base}/wp/v2/posts/${id}/revisions/${revisionId}?_embed`,\n\n    cptRevisions: (id, type) =>\n        `${base}/wp/v2/${type}/${id}/revisions?filter[orderby]=date&order=desc`,\n    cptRevision: (id, type, revisionId) =>\n        `${base}/wp/v2/${type}/${id}/revisions/${revisionId}?_embed`,\n\n};\n\ndebug('CMS Service: using base: ', base);\n\nconst getRoutes = async () => {\n    const resp = await axios.get(endpoints.routes());\n    return transformers\n        .routeTransformer(resp.data);\n}\n\nconst getPrimaryMenu = async () => {\n    const resp = await axios.get(endpoints.primaryMenu());\n    return transformers\n        .menuTransformer(resp.data);\n}\n\nconst getMedia = async (id, nonce) => {\n    debug('CMS getMedia() called!');\n    debug('CMS getMedia() nonce: ', nonce);\n    debug('CMS getMedia() media id: ', id);\n\n    const resp = await axios.get(endpoints.media(id), authConfig(nonce));\n    debug('CMS getMedia() transformed data: ', transformers.featuredImageTransformer(resp.data));\n\n    return transformers\n        .featuredImageTransformer(resp.data) \n}\n\nconst getDate = async () => {\n    return await axios.get(endpoints.date());\n}\n\nconst getContent = async (id, type) => {\n    let resp; \n\n    debug('CMS getContent(): fetching content for id: ', id);\n\n    switch(type) {\n        case 'page':\n            resp = await axios.get(endpoints.page(id));\n            break;\n        case 'post':\n            resp = await axios.get(endpoints.post(id));\n            break;\n        default: \n            resp = await axios.get(endpoints.cpt(id, type));\n            break;\n    }\n\n    return transformers\n        .pageDataTransformer(resp.data);\n}\n\nconst getRevisions = async (id, type, nonce) => {\n    let resp;\n    \n    switch (type) {\n        case 'page':\n            resp = await axios.get(endpoints.pageRevisions(id), authConfig(nonce));\n            break;\n        case 'post':\n            resp = await axios.get(endpoints.postRevisions(id), authConfig(nonce));\n            break;\n        default:\n            resp = await axios.get(endpoints.cptRevisions(id, type), authConfig(nonce));\n            break;\n    }\n\n    debug('CMS getRevisions(): fetched revision list for id: ', id, resp.data);\n\n    return resp.data; \n}\n\nconst getRevision = async (id, type, revisionId, nonce) => {\n\n    debug('CMS getRevision(): fetching revision content for id: ', id);\n\n    let resp;\n    switch (type) {\n        case 'page':\n            resp = await axios.get(endpoints.pageRevision(id, revisionId), authConfig(nonce));\n            break;\n        case 'post':\n            resp = await axios.get(endpoints.postRevision(id, revisionId), authConfig(nonce));\n            break;\n        default:\n            resp = await axios.get(endpoints.cptRevision(id, type, revisionId), authConfig(nonce));\n            break;\n    }\n\n    return transformers\n        .pageDataTransformer(resp.data);\n}\n\nconst getContentPreview = async (id, type, previewMediaId, nonce) => {\n    let pageData = {}, featuredImage = {}, revs = {};\n\n    debug('CMS getContentPreview() called!');\n    debug('CMS getContentPreview() nonce: ', nonce); \n    debug('CMS getContentPreview() preview media id: ', previewMediaId); \n\n    revs = await getRevisions(id, type, nonce);\n    debug('CMS: received post revision list: ', revs);\n\n    [featuredImage, pageData] = await Promise.all([\n        previewMediaId > 0 \n            ? getMedia(previewMediaId, nonce)\n            : undefined, \n        getRevision(id, type, revs[0].id, nonce)\n    ]);\n\n    debug('CMS: getContentPreview() - received preview media data: ', featuredImage);\n\n    return {\n        ...pageData, \n        featuredImage\n    }\n}\n\n\nexport {\n    getRoutes,\n    getPrimaryMenu,\n    getDate,\n    getMedia, \n    getContent, \n    getContentPreview,\n}","import { debug } from '../../utils';\n\nconst defaultTtl = 10 * 1000;\nlet currentTtl = defaultTtl; \n\nlet entries = {}; \n\nconst now = () => \n    new Date().getTime(); \n\nconst setTtl = (ttl) => {\n    debug(`Cache: setting cache ttl to ${ttl}ms`);\n    currentTtl = ttl; \n}\n\nconst remove = (key) =>\n    entries = Object.keys(entries)\n        .reduce((obj, k) => {\n            if (k !== key) {\n                obj[k] = entries[k]\n            }\n\n            return obj;\n        }, {}); \n\nconst hasKey = (key) => {\n    if(!(key in entries)) {\n        return false; \n    }\n\n    const entry = entries[key];\n\n    if (now() - entry.timestamp > currentTtl) {\n        debug(`Cache: entry with key \"${key}\" has expired`);\n        remove(key);\n\n        return false;\n    }\n\n    return true; \n}\n\nconst set = (key, value) => \n    entries = {\n        ...entries, \n        [key]: {\n            value, \n            timestamp: now()\n        }\n    };\n\nconst get = (key) => {\n    if (!(key in entries)) {\n        return null;\n    }\n\n    const entry = entries[key];\n\n    if (now() - entry.timestamp > currentTtl) {\n        debug(`Cache: entry with key \"${key}\" has expired`);\n        remove(key);\n        return null; \n    }\n\n    debug(`Cache: found entry with key \"${key}\", time left: `, now() - entry.timestamp);\n\n    return entry.value; \n};\n\nexport {\n    setTtl, \n    hasKey, \n    set, \n    remove,\n    get\n}","import {\n    observable,\n    action,\n    runInAction,\n    set,\n    has,\n    configure as configureStore,\n} from 'mobx';\n\nimport queryString from 'query-string';\n\nimport { \n    isFn, \n    debug \n} from '../utils';\n\nimport config from '../config';\n\nimport * as cms from '../services/cms';\nimport * as cache from '../services/cache';\n\nclass Store {\n    debug = true; \n\n    states = {\n        error: 'error',\n        loading: 'loading',\n        ready: 'ready'\n    };\n\n    constructor(initialState) {\n        configureStore({\n            enforceActions: 'always'\n        });\n\n        cache.setTtl(config.cacheTtl);\n\n        runInAction(() => {\n            Object.assign(this, initialState || {});\n\n        });\n\n        if(process.env.BABEL_ENV === 'client') {\n            this.setQueryParams(queryString.parse(window.location.search));\n        }\n    }\n\n    // main ui state\n    @observable state = this.states.loading;\n\n    // global state\n    serverSideBootstrapped = false; \n    locationChanged = false; \n    currentQuery = {};\n    wpRestNonce = {};\n\n    @observable routes = [];\n    @observable primaryMenu = {}; \n    @observable content = observable.object({}); \n\n    // current page state \n    @observable pageData = observable.object({});\n    @observable pageInitialProps = observable.object({}); \n\n    @action \n    async bootstrap() {\n        debug('Store: bootstrapping!');\n\n        if (process.env.BABEL_ENV === 'client') {\n            this.wpRestNonce = window.__FROJD_SETTINGS \n                && window.__FROJD_SETTINGS.wpRestNonce\n                    ? window.__FROJD_SETTINGS.wpRestNonce \n                    : 'NONE';\n\n            debug('Store: using injected wp rest nonce: ', this.wpRestNonce);\n        }\n\n        await Promise.all([\n            this.loadRoutes(),\n            this.loadPrimaryMenu()\n        ]);\n\n        debug('Store: loaded routes & menus!');\n\n        runInAction(() => {\n            this.state = this.states.ready; \n        });\n    }\n\n    setLocationChanged(bool) {\n        this.locationChanged = bool; \n    } \n\n    setServerSideBootstrapped(bool) {\n        this.serverSideBootstrapped = bool; \n    }\n\n    setQueryParams(params) {\n        debug('Store: setting query params to: ', params);\n        this.currentQuery = params;\n    }\n\n    get hasQueryParams() {\n        return Object.keys(this.currentQuery).length > 0; \n    }\n\n    get hasPreviewQuery() {\n        return this.hasQueryParams \n            && 'preview' in this.currentQuery \n            && this.currentQuery['preview'] === 'true'; \n    }\n\n    @action\n    async loadContentAndInitialProps(id, type, getInitialProps) {\n\n        debug('Store: loadContentAndInitialProps() called - loading content and initial props');\n        debug('Store: current query params: ', this.currentQuery);\n\n        // clear page data \n        // (in order to not render incorrect data on new page while new page data is loading)\n        this.pageData = observable.object({}); \n        debug('Store: cleared pageData'); \n\n        // clear initial props\n        // (in order to not render incorrect data on new page while new page props are loading)\n        this.pageInitialProps = observable.object({}); \n        debug('Store: cleared pageInitialProps'); \n\n        let loadContent = () => this.hasPreviewQuery\n            ? this.loadContentPreview(id, type)\n            : this.loadContent(id, type);\n\n        await Promise.all([\n            loadContent(), \n            isFn(getInitialProps) \n                ? this.loadInitialProps(getInitialProps)\n                : undefined\n        ]); \n    }\n    \n    @action\n    async loadContent(id, type) {\n        debug('Store: loadContent() called - loading page data '); \n\n        if(cache.hasKey(id)) {\n            set(this.pageData, cache.get(id));\n            debug('Store: loadContent() - page data found in cache, returning cached data');\n            return;\n        }\n\n        try {\n            const content = await cms.getContent(id, type);\n\n            runInAction(() => {\n                cache.set(id, content);\n                set(this.pageData, content);\n\n                debug('Store: set pageData: ', this.pageData);\n            });\n\n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n            });\n        }\n    }\n\n    @action\n    async loadContentPreview(id, type) {\n        const mediaId = '_thumbnail_id' in this.currentQuery\n                ? this.currentQuery['_thumbnail_id']\n                : -1; \n            \n        debug('Store: loadContentPreview() called - loading PREVIEW page data ');\n        debug('Store: loadContentPreview() - will load featured media preview with media id: ', mediaId);\n\n        try {\n            const content = await cms.getContentPreview(id, type, mediaId, this.wpRestNonce);\n\n            runInAction(() => {\n                debug('Store: setting PREVIEW pageData: ', this.pageData);\n                set(this.pageData, content);\n            });\n\n        } catch (error) {\n            debug('Store: loadContentPreview() FAILED, reason: ', error);\n            runInAction(() => {\n                this.state = this.states.error;\n            });\n        }\n    } \n    @action \n    async loadInitialProps(getInitialProps) {\n        debug('Store: loadInitialProps() called - loading props!');\n\n        try {\n            const props = await getInitialProps();\n\n            runInAction(() => {\n                debug('Store: fetched initial props!');\n                set(this.pageInitialProps, props);\n            }); \n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n                throw error; \n            });\n        }\n    }\n\n    @action\n    async loadRoutes() {\n        try {\n            const routes = await cms.getRoutes();\n            runInAction(() => {\n                this.routes = routes;\n            });\n\n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n                throw error; \n            });\n        }\n    }\n\n    @action\n    async loadPrimaryMenu() {\n        try {\n            const menu = await cms.getPrimaryMenu();\n\n            runInAction(() => {\n                this.primaryMenu = menu;\n            });\n        } catch (error) {\n            runInAction(() => {\n                this.state = this.states.error;\n                throw error; \n            });\n        }\n    }\n}\n\nexport default Store;\n","import React from 'react';\n\nimport { toJS } from 'mobx';\nimport jsonStringifySafe from 'json-stringify-safe';\nimport * as base64 from 'base64util';\n\nimport { \n    definedNotNull,\n    debug\n} from '../utils';\n\nimport Store from './Store';\n\nconst storeContext = React.createContext();\nlet defaultStore = new Store(); \n\nconst dehydrate = (store) => {\n    return base64.encode(jsonStringifySafe(toJS(store, true)));\n};\n\nconst rehydrate = (storeJson) => {\n    return JSON.parse(base64.decode(storeJson));\n}\n\nif (process.env.BABEL_ENV === 'client' // hydrate ssr \n    && definedNotNull(window.__FROJD_STATE)) \n{\n    let state = rehydrate(window.__FROJD_STATE);\n    defaultStore = new Store(state);\n\n    debug('Hydrated store with state: ', state);\n} else if (process.env.BABEL_ENV === 'client') { // ssr failed/not available, start bootstrap\n    defaultStore.bootstrap(); \n}\n\nconst StoreProvider = ({ store, children }) => {\n    const __store = definedNotNull(store)\n        ? store \n        : defaultStore; \n\n    return (\n        <storeContext.Provider value={__store}>\n            {children}\n        </storeContext.Provider>\n    );\n}\n\nconst MockStoreProvider = ({ store, children }) => {\n    return (\n        <storeContext.Provider value={store}>\n            {children}\n        </storeContext.Provider>\n    );\n}\n\nconst useStore = () => {\n    const store = React.useContext(storeContext);\n\n    if (!store) {\n        throw new Error('You\\'ve forgotten to use <StoreProvider/>, well shame on you...');\n    }\n\n    return store;\n}\n\nexport {\n    Store,\n    StoreProvider,\n    MockStoreProvider,\n    useStore,\n    dehydrate, \n    rehydrate\n}\n","import { \n    useRef,\n    useEffect\n } from 'react';\n\n// compare current & prev. props \nfunction usePrevious(value) {\n    const ref = useRef();\n\n    useEffect(() => {\n        ref.current = value;\n    }, [value]);\n\n    return ref.current;\n}\n\nexport default usePrevious; ","import { useState } from 'react';\nimport queryString from 'query-string';\n\nimport { useStore } from '../../store';\nimport { debug } from '../../utils';\n\nfunction useForceSsrLoad() {\n    const store = useStore(); \n    const [didReload, setDidReload] = useState(false);\n\n    if (process.env.BABEL_ENV === 'client' && store.serverSideBootstrapped) {\n        const { r } = queryString.parse(location.search);\n\n        if(!r && !didReload && store.locationChanged) {\n            debug('useForceSsrLoad() hook: page not yet reloaded - reloading!');\n            setDidReload(true);\n            window.location = `${window.location}?r=true`; \n\n            return true; \n        }\n\n        if (!r && didReload) {\n            return true; \n        }\n    }\n\n    debug('useForceSsrLoad() hook: NOT reloading!');\n    return false; \n}\n\n\nexport default useForceSsrLoad; \n","import usePrevious from './use-previous';\nimport useForceSsrLoad from './use-force-ssr-load';\n\nexport {\n    usePrevious,\n    useForceSsrLoad\n}","\nimport React, {\n    useEffect,\n} from 'react';\n\nimport { Link } from 'react-router-dom';\n\nimport { observer } from 'mobx-react-lite';\nimport { useStore } from '../../store';\n\nconst Header = observer(() => {\n    let store = useStore();\n\n    return (\n        <header>\n            {store.primaryMenu && store.primaryMenu.items.map((item, i) => (\n                <Link key={i} to={item.url}>\n                    {item.title}\n                </Link>\n            ))}\n        </header>\n    );\n}); \n\nexport default Header; ","import Header from './Header';\nexport default Header; ","import React from 'react';\n\nimport { Helmet } from 'react-helmet-async';\n\nconst NotFound = () => {\n    return (\n        <>\n            <Helmet>\n                <title>404</title>\n            </Helmet>\n\n            <div>\n                <h1>404</h1>\n                <p>The page could not be found</p> \n            </div>\n        </>\n    );\n};\n\nexport default NotFound;","import NotFound from './NotFound';\n\nexport default NotFound; ","import React from 'react';\n\nconst RawHtml = ({html, ...props}) => (\n    <div dangerouslySetInnerHTML={{__html: html}}></div>\n);\n\nexport default RawHtml; ","import RawHtml from './RawHtml';\n\nexport default RawHtml; \n","import React from 'react';\nimport { observer } from 'mobx-react-lite';\n\nimport { Helmet } from 'react-helmet-async';\nimport RawHtml from '../../components/RawHtml';\n\nimport { useForceSsrLoad } from '../../hooks';\n\nimport {getDate as getServerSideDate} from '../../services/cms';\n\nconst Start = observer(({ pageData, initialProps }) => {\n    const willReload = useForceSsrLoad(); \n    if(willReload) {\n        return null; \n    }\n\n    const { date } = initialProps;\n    const { title, content } = pageData; \n    \n    return (\n        <>\n            <Helmet>\n                <title>Start Page</title>\n            </Helmet>\n            <div>\n                <h1>Start page: {title}</h1>\n                <p>date initial prop: {date}</p>\n\n                <RawHtml html={content} />                \n            </div>\n        </>\n    );\n});\n\nStart.getInitialProps = async () => {\n    let resp = await getServerSideDate(); \n\n    return {\n        date: resp.data['date']\n    }\n};\n\nexport default Start;\n","import Start from './Start';\n\nexport default Start; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { Helmet } from 'react-helmet-async';\n\nimport RawHtml from '../../components/RawHtml';\n\nconst Page = observer(({ pageData }) => {\n    const { title, content, featuredImage } = pageData; \n\n    return (\n        <>\n            <Helmet>\n                <title>Page</title>\n            </Helmet>\n            <div>\n                <h1>A page: {title}</h1>\n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n                \n                <RawHtml html={content} />\n            </div>\n\n        </>\n    );\n}); \n\nexport default Page;\n","import Page from './Page';\n\nexport default Page; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { Helmet } from 'react-helmet-async';\n\nimport RawHtml from '../../components/RawHtml';\n\nconst Post = observer(({ pageData }) => {\n    const { title, content, featuredImage } = pageData;\n\n   return  (\n        <>\n            <Helmet>\n                <title>Post</title>\n            </Helmet>\n            <div>\n                <h1>A poooost: {title}</h1>\n                \n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n\n                <RawHtml html={content} />\n            </div>\n        </>\n   );\n});\n\nexport default Post;\n","import Post from './Post';\n\nexport default Post; ","import React from 'react';\n// import { observer } from 'mobx-react-lite';\n\nimport './index.scss';\n\nconst UnknownBlock = ({ missingComponentId }) => {\n    return (\n        <div className=\"UnknownBlock\">\n            Could not find block with id: \"{missingComponentId}\"\n        </div>\n    );\n}; \n\nexport default UnknownBlock; ","import UnknownBlock from './UnknownBlock';\nexport default UnknownBlock; ","import React from 'react';\nimport { observer } from 'mobx-react-lite';\n\nimport { Link } from 'react-router-dom';\n\nimport './index.scss';\n\nconst BlurbFull = observer(({ title, image, link }) => {\n    return (\n        <div className=\"BlurbFull\">\n            <h1>{title}</h1>\n            \n            {image && \n                <img src={image} />\n            }\n\n            <Link to={link.url}>\n                Click here\n            </Link>\n        </div>\n    );\n}); \n\nexport default BlurbFull; ","import BlurbFull from './BlurbFull';\nexport default BlurbFull; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { debug } from '../../utils';\n\nimport UnknownBlock from '../../blocks/UnknownBlock';\nimport BlurbFull from '../../blocks/BlurbFull';\n\nconst blockComponents = {\n    'blurb_full': BlurbFull\n};\n\nconst Blocks = observer(({ items }) => {\n    debug('Blocks> passed block items: ', items);\n\n    if(!items || !items.length) {\n        return null; \n    }\n\n    return (\n        <div className=\"Blocks\">\n            {items.map((block, i) => {\n                const { acfFcLayout, ...props } = block; \n\n                if (!(acfFcLayout in blockComponents)) {\n                    return <UnknownBlock key={i} missingComponentId={acfFcLayout} />;\n                }\n                \n                const Block = blockComponents[acfFcLayout];\n\n                debug(`Blocks> found block component for ${acfFcLayout}: `, Block);\n                debug('Blocks> passing block props: ', props); \n\n                return <Block key={i} {...props} />; \n            })}\n        </div>\n    );\n}); \n\nexport default Blocks; ","import Blocks from './Blocks';\nexport default Blocks; ","import React from 'react';\n\nimport { observer } from 'mobx-react-lite';\nimport { Helmet } from 'react-helmet-async';\n\nimport Blocks from '../../layout/Blocks';\nimport RawHtml from '../../components/RawHtml';\n\nimport * as cms from '../../services/cms';\n\nconst Recipe = observer(({ id, url, pageData, initialProps }) => {\n    const { title, content, featuredImage, recipeScore, blocks } = pageData; \n    const { date } = initialProps; \n\n    return (\n        <>\n            <Helmet>\n                <title>Recipe Page</title>\n            </Helmet>\n            <div>\n                <h1>Recept: {title}</h1>\n                <h3>date initial prop: {date}</h3>\n                <h4>Score: {recipeScore ? recipeScore : 'saknas'}</h4>\n\n                {featuredImage &&\n                    <img src={featuredImage.sizes.thumbnail.url} />\n                }\n                \n                <p>id: {id}</p>\n                <p>url: {url}</p>\n\n                <RawHtml html={content} />\n\n                {blocks && \n                    <Blocks items={blocks} />                \n                }\n            </div>\n        </>\n    );\n});\n\nRecipe.getInitialProps = async () => {\n    const resp = await cms.getDate(); \n\n    return {\n        date: resp.data['date']\n    }\n};\n\nexport default Recipe;","import Recipe from './Recipe';\n\nexport default Recipe; ","\nimport React, { \n    useEffect\n} from 'react';\n\nimport { \n    Switch, \n    Route, \n    withRouter,\n} from 'react-router-dom';\n\nimport { values } from 'mobx';\n\nimport { observer } from 'mobx-react-lite';\nimport { useStore } from './store';\nimport { usePrevious } from './hooks';\n\nimport Header from './layout/Header';\nimport NotFound from './pages/NotFound';\n\nimport Start from './pages/Start';\nimport Page from './pages/Page';\nimport Post from './pages/Post';\nimport Recipe from './pages/Recipe';\n\nimport { defined, debug } from './utils';\n\nconst pageComponents = {\n    'Start': Start, \n    'Page': Page, \n    'Post': Post, \n    'Recipe': Recipe\n};\n\nconst LocationSwitch = withRouter((props) => {\n    let store = useStore();\n\n    const { children } = props; \n    const prevProps = usePrevious(props);\n\n    // check whether user has navigated or whether this is the initial load without a hydrated store \n    // if yes, set location to changed in order to trigger page data & initial props load \n    // for route (see renderRoute()) \n\n    if ((prevProps && prevProps.location.pathname !== props.location.pathname) \n        || (!prevProps && !store.serverSideBootstrapped)) \n    {\n        debug('LocationSwitch> setting location changed state to: ', true);\n\n        store.setLocationChanged(true);\n    } else {\n        debug('LocationSwitch> setting location changed state to: ', false);\n        debug('LocationSwitch> was ssr bootstrapped: ', store.serverSideBootstrapped);\n\n        store.setLocationChanged(false);\n    }\n\n    return (\n        <Switch>\n            {children}\n        </Switch>\n    ); \n}); \n\nconst App = observer(({ ssr = false }, ref) => {\n    let store = useStore();\n\n    // trigger a rerender when these props are changed (mobx4 :/)\n    values(store.pageData); \n    values(store.pageInitialProps);\n\n    if(store.state === store.states.loading) {\n        return (\n            <div>Loading...</div>\n        );\n    }\n\n    if (store.state === store.states.error) {\n        return (\n            <div>An error occured!</div>\n        );\n    }\n\n    const renderRoute = (props, route) => {\n        debug('App> renderRoute() called');\n        debug('App> has location changed?', store.locationChanged);\n\n        const PageComponent = pageComponents[route.component];\n\n        // expose promises in ref (enables us to wait for \n        // data load when doing ssr, see server/lib/ssr/index.js).\n\n        if(ref && defined(ref.current) && ref.current === null) { // ssr\n            debug('App> renderRoute is triggering SSR data & props load procedure - will not render this run'); \n\n            ref.current = {\n                contentPromise: store.loadContentAndInitialProps(\n                    route.id, \n                    route.postType, \n                    PageComponent.getInitialProps\n                )\n            };\n\n            // don't render anything here, just trigger the promise \n            // the ssr renderer will trigger a new render when the promise is resolved\n\n            return null; \n        } else if(!ssr && store.locationChanged) { // client \n            debug('App> renderRoute is triggering CLIENT data & props load procedure'); \n\n            store.loadContentAndInitialProps(\n                route.id, \n                route.postType, \n                PageComponent.getInitialProps\n            );\n        }\n\n        debug('App> current loaded pageData: ', store.pageData);\n\n        return (\n            <PageComponent\n                id={route.id}\n                type={route.postType}\n                url={route.url}\n\n                pageData={store.pageData}\n                initialProps={store.pageInitialProps}\n\n                {...props}\n            />\n        );\n    };\n\n    return (\n        <>\n            <Header />\n            <LocationSwitch ssr={ssr}>\n                {store.routes.map(route => (\n                    <Route\n                        exact\n                        key={route.url}\n                        path={route.url}\n                        render={(props) => renderRoute(props, route)}\n                    />\n                ))}\n                <Route component={NotFound} />\n            </LocationSwitch>\n        </>\n    );\n\n}, { forwardRef: true });\n\nexport default App;\n","import React, {\n    createRef,\n} from 'react';\n\nimport ReactDOMServer from 'react-dom/server';\n\nimport { useStaticRendering } from 'mobx-react-lite';\n\nimport { HelmetProvider } from 'react-helmet-async';\nimport { StaticRouter } from 'react-router-dom';\n\nimport { \n    StoreProvider, \n    Store, \n    dehydrate \n} from '../../../app/store';\n\nimport App from '../../../app/App';\n\nimport { debug }  from '../../../app/utils';\n\nuseStaticRendering(true);\n\nconst ssrRenderer = async (req, res) => {\n    let appRef = createRef(null);\n\n    const context = {};\n    const helmetContext = {};\n    \n    const store = new Store(); \n\n    // store.setQueryParams(req.query);\n    debug('SSR renderer: received request for: ', req.url);\n\n    debug('SSR renderer: calling store bootstrap!');\n    await store.bootstrap();\n\n    const component = (\n        <StoreProvider store={store}>\n            <HelmetProvider context={helmetContext}>\n                <StaticRouter\n                    location={req.originalUrl}\n                    context={context}\n                >\n                    <App \n                        ssr={true}\n                        ref={appRef}    \n                    />\n                </StaticRouter>\n            </HelmetProvider>\n        </StoreProvider>\n    );\n\n\n    // render once to trigger router & content data load, then await \n    // data load promise exposed by the <App> ref & re-render with loaded data.\n\n    let app = '';\n    ReactDOMServer.renderToString(component);\n    if (appRef.current && appRef.current.contentPromise) {\n        debug('SSR Renderer: waiting for content promise!');\n        await appRef.current.contentPromise;\n\n        debug('SSR Renderer: content promise resolved!');\n        app = ReactDOMServer.renderToString(component);\n    }\n\n    store.setServerSideBootstrapped(true);\n\n    const html = `\n        <div id=\"root\">${app}</div>\n        <script>\n            window.__FROJD_STATE = '${dehydrate(store)}';\n        </script>\n    `;\n\n    if (context.url) {\n        debug('SSR renderer: 301 redirect!');\n        res.writeHead(301, { Location: context.url });\n        res.end();\n    } else {\n        debug('SSR renderer: responding with rendered html!');\n        res.send(html);\n    }\n};\n\nexport default ssrRenderer;","import express from 'express';\nimport path from 'path';\nimport log from 'llog';\n\nimport ssr from './lib/ssr';\n\nconst port = process.env.PORT || 1234;\n\nconst server = express();\nconst serveStatic = express.static;\n\nserver.use(\n    '/dist/client',\n    serveStatic(path.resolve(process.cwd(), '__dist', 'client'))\n);\n\nserver.get('/*', ssr);\n\nserver.listen(port, () => {\n    log.info(`Listening on port ${port} - have fun!`)\n});"]}